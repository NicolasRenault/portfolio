---
import Layout from "../../layouts/MainLayout.astro";
import { astroI18n, t } from "astro-i18n";

astroI18n.init(Astro);
---

<Layout title={"Projects"}>
	<main>
		<h1 class="text-gradient">Projects</h1>
	</main>
</Layout>

<script>
	interface Project {
		html_url: any;
		stargazers_count: any;
		forks_count: any;
		fork: any;
		name: string;
		description: string;
		language: string;
		stars: number;
		forks: number;
		is_fork: boolean;
		created_at: string;
	}

	import ProjectCard from "../../components/ProjectCard.astro";

	const query = await fetch(
		'https://api.github.com/users/NicolasRenault/repos?sort="created"'
	).then((res) => {
		if (!res.ok) {
			throw new Error("Failed to fetch");
		}
		return res.json();
	});

	const repos = query.map((repo: Project) => ({
		name: repo.name,
		description: repo.description,
		url: repo.html_url,
		language: repo.language,
		stars: repo.stargazers_count,
		forks: repo.forks_count,
		is_fork: repo.fork,
		created_at: repo.created_at,
	}));

	repos.forEach((_project: Project) => {
		console.log(_project);
		//Create an HTML object and append it to the main element
		const project = document.createElement("project-card");
		const h1 = document.createElement("h1");
		h1.textContent = _project.name;
		project.appendChild(h1);
		const h2 = document.createElement("h2");
		h2.textContent = new Date(_project.created_at).getFullYear().toString();
		project.appendChild(h2);
		document.querySelector("main")?.appendChild(project);
	});
</script>

<style lang="scss">
	main {
		margin: auto;
		padding: 1.5rem;
		max-width: 60ch;
	}
	h1 {
		font-size: 3rem;
		font-weight: 800;
		margin: 0;
	}
	.text-gradient {
		background-image: var(--accent-gradient);
		background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
</style>
